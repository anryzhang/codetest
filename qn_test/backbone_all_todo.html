<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
    <script src="http://documentcloud.github.com/backbone/backbone-min.js"></script>
</head>
<body>

<div id="search_container"></div>

<script id="search_template" type="text/template">
    <label><%=search_label %></label>
    <input type="text" id="search_input">
    <input value="Search" id="search_button" type="button"/>

</script>
<script>
(function($){
    var Todo = Backbone.Model.extend({
       //设置默认属性
        defaults:{
            content:'empty todo...',
            done: false
        },
        initialize:function(){
            if(!this.get("content")){
                this.set({"content":this.defaults.content});
            }
        },
        //将一个任务的完成状态置为逆状态
        toggle:function(){
            this.save({done:!this.get("done")});
        },
        //从localStorage中删除一个条目
        clear:function(){
            this.destory();
        }
    });

   var TodoList = Backbone.Collection.extend({
      //设置Collection的模型为Todo
       model:Todo,
       //存储到本地,以todos-backbone命名的空间中
       localStorage:new Store('todos-backbone'),
       //获取所有已经完成的任务数组
       done:function(){
           return this.filter(function(todo){
               return todo.get("done");
           });
       },
       //获取任务列表中未完成的任务数组
       remaining:function(){
           return this.without.apply(this,this.done());
       },
       //获得下一个任务的排序序号,通过数据库中记录数加1实现
       nextOrder:function(){
           if(!this.length){
               return 1;
           }
           return this.last().get("order") + 1;
       },
       //Backbone内置函数,根据todo对象的加入顺序进行排列
       comparator:function(todo){
           return todo.get('order');
       }
   });

    var Todos = new TodoList;
    //TodoView,作用是控制任务列表
    var TodoView = Backbone.View.extend({
        //下面这个标签的作用,是把template模板中获取到的html代码放到这个标签中
        tagName:"li",
        //获取一个任务条目的模板
        template: _.template($('#item-template').html()),
        //为每一个任务条目绑定事件
        events:{
            "click.check":'toggleDone',
            "dblclick label.todo-content":"edit",
            "click span.todo-destroy":"clear",
            "keypress.todo-input":"updateOnEnter"
            "blur.todo-input":"close"
        },
        //在初始化设置了todoview和todo的以一对一引用,这里可以把todoview看作是todo在界面上的映射.
        initialize:function(){
            _.bindAll(this,'render','close','remove');
            this.model.bind('change',this.render);
            this.model.bind('destroy',this.remove);
        },
        //渲染todo中数据到item-template中,然后返回对自己的引用this
        render:function(){
            $(this.el).html(this.template(this.model.toJSON()));
            this.input = this.$('.todo-input');
            return this;
        },
        //控制任务完成或者未完成
        toggleDone:function(){
            this.model.toggle();
        },
        //修改任务条目的样式
        edit:function(){
            $(this.el).addClass("editing");
            this.input.focus();
        },
        //关闭编辑界面,并


    });

})(jQuery);

</script>
</body>
</html>